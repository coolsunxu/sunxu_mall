# 应用服务 WEB 访问端口
server:
  port : 8011

# Spring配置
spring:
  config:
    import: "classpath:application-secret.yml"
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://127.0.0.1:3306/mall?useUnicode=true&serverTimezone=UTC&characterEncoding=UTF-8
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
  # 修复 Spring Boot 2.6.x 与 Swagger 兼容性问题
  mvc:
    pathmatch:
      matching-strategy: ant_path_matcher
  web:
    resources:
      add-mappings: false

logging:
  level:
    com.example.sunxu_mall: INFO

mybatis:
  mapper-locations: classpath:com/example/sunxu_mall/mapper/**/*.xml
  type-aliases-package: com.example.sunxu_mall.entity
  configuration:
    map-underscore-to-camel-case: true


# SpringDoc OpenAPI 配置
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    enabled: true
    path: /swagger-ui.html
    operations-sorter: method

# Redisson配置
redisson:
  filepath: "classpath:redisson.yaml"

# 项目自定义配置（含敏感信息，生产环境请使用 application-secret.yaml）
mall:
  mgt:
    # 令牌配置
    tokenExpireTimeInRecord: 3600
    # 验证码过期时间（秒）
    captchaExpireSecond: 300
    # 密码加密私钥（生产环境请在环境变量或 application-secret.yaml 中配置）
    tokenSecret: ${TOKEN_SECRET}
    captcha:
      enabled: false
    password:
      privateKey: ${PASSWORD_PRIVATE_KEY}
      publicKey: ${PASSWORD_PUBLIC_KEY}

    # 异步线程池配置
    async:
      pools:
        login:
          core-size: 4
          max-size: 10
          queue-capacity: 100
          keep-alive-seconds: 60
          thread-name-prefix: "async-login-"

    # IP城市查询配置（使用 @ConditionalOnProperty 根据此配置自动选择服务实现）
    ip-city:
      # 高德API配置（生产环境建议在 application-secret.yaml 中配置密钥）
      amap:
        key: ${AMAP_API_KEY}  # 请在生产环境使用真实的API密钥
        url: https://restapi.amap.com/v3/ip
      # GeoLite2配置
      geolite2:
        db-path: "classpath:geoip/GeoLite2-City.mmdb"
        account-id: ${GEOLITE2_ACCOUNT_ID}  # MaxMind Account ID
        license-key: ${GEOLITE2_LICENSE_KEY}  # MaxMind License Key
        url: https://geolite.info/geoip/v2.1/city
      # 缓存配置
      cache:
        caffeine-ttl-seconds: 3600  # L1 本地缓存过期时间 (默认1小时)
        caffeine-max-size: 10000    # L1 本地缓存最大条目数 (默认10000)
        redis-ttl-seconds: 86400    # L2 Redis缓存过期时间 (默认24小时)



ok:
  http:
    connect-timeout: 10s
    read-timeout: 10s
    write-timeout: 10s
    connection-pool:
      max-idle-connections: 32
      keep-alive-duration: 5m
    follow-ssl-redirects: true
    follow-redirects: true
