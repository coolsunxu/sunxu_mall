# 应用服务 WEB 访问端口
server:
  port : 8011

# Spring配置
spring:
  config:
    import: "classpath:application-secret.yml"
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://127.0.0.1:3306/mall?useUnicode=true&serverTimezone=UTC&characterEncoding=UTF-8
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:123456}
    # Druid 连接池配置（含慢查询日志）
    druid:
      initial-size: 5
      min-idle: 5
      max-active: 20
      max-wait: 60000
      # 慢查询日志配置
      filter:
        stat:
          enabled: true
          slow-sql-millis: 1000  # 慢查询阈值（毫秒）
          log-slow-sql: true     # 记录慢查询日志
          merge-sql: true        # 合并相同 SQL
        slf4j:
          enabled: true
          statement-executable-sql-log-enable: true
      # 监控统计
      stat-view-servlet:
        enabled: false  # 生产环境建议关闭或配置访问控制
        url-pattern: /druid/*
  # 修复 Spring Boot 2.6.x 与 Swagger 兼容性问题
  mvc:
    pathmatch:
      matching-strategy: ant_path_matcher
  web:
    resources:
      add-mappings: false
  # Kafka 配置
  kafka:
    bootstrap-servers: 127.0.0.1:9092
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
    consumer:
      group-id: mall-group
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer

# RocketMQ 配置
rocketmq:
  name-server: 117.72.88.11:9876
  producer:
    group: mall-rocket-producer-group
    send-message-timeout: 3000
  consumer:
    group: mall-rocket-consumer-group

# 自定义 MQ 业务配置
app:
  mq:
    kafka:
      topic: mall-kafka-topic
      topic2: mall-kafka-topic-2 # 测试用第二个 Topic
    rocket:
      topic: mall-rocket-topic
      topic2: mall-rocket-topic-2 # 测试用第二个 Topic
    type: local # 测试用配置

logging:
  level:
    com.example.sunxu_mall: INFO

mybatis:
  mapper-locations: classpath:com/example/sunxu_mall/mapper/**/*.xml
  configuration:
    map-underscore-to-camel-case: true

# PageHelper 已移除，统一使用游标分页

# SpringDoc OpenAPI 配置
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    enabled: true
    path: /swagger-ui.html
    operations-sorter: method

# Redisson配置
redisson:
  filepath: "classpath:redisson.yaml"

# 项目自定义配置（含敏感信息，生产环境请使用 application-secret.yaml）
mall:
  # CORS 跨域配置（可按环境覆盖）
  cors:
    allowed-origins:
      - http://localhost:3000
      - http://localhost:3001
      - http://127.0.0.1:3000
      - http://127.0.0.1:3001
    allow-credentials: true
    max-age: 3600
  # 安全配置
  security:
    # 是否放行 WebSocket 端点（本地/测试环境设为 true，生产环境设为 false 并要求 token）
    permit-web-socket: true
    # 额外需要放行的 URL 模式
    permit-urls: []
  # 性能监控配置
  performance:
    # 是否启用性能日志
    enabled: true
    # 慢接口阈值（毫秒），超过此值输出警告日志
    slow-api-threshold-ms: 1000
  mgt:
    maxOffsetForTotal: 5000
    async:
      pools:
        login:
          core-size: 4
          max-size: 10
          queue-capacity: 100
          keep-alive-seconds: 60
          thread-name-prefix: "async-login-"
        common:
          core-size: 2
          max-size: 5
          queue-capacity: 200
          keep-alive-seconds: 60
          thread-name-prefix: "async-common-"
        # 导出任务专用线程池（IO 密集型，独立隔离避免影响其他异步任务）
        export:
          core-size: 2
          max-size: 4
          queue-capacity: 50
          keep-alive-seconds: 120
          thread-name-prefix: "async-export-"
        # 通知任务专用线程池
        notification:
          core-size: 2
          max-size: 5
          queue-capacity: 150
          keep-alive-seconds: 60
          thread-name-prefix: "async-notification-"
    tokenExpireTimeInRecord: 3600
    # 验证码过期时间（秒）
    captchaExpireSecond: 300
    # 密码加密私钥（生产环境请在环境变量或 application-secret.yaml 中配置）
    tokenSecret: ${TOKEN_SECRET:dummy_token_secret}
    captcha:
      enabled: false
    password:
      privateKey: ${PASSWORD_PRIVATE_KEY:dummy_private_key}
      publicKey: ${PASSWORD_PUBLIC_KEY:dummy_public_key}
  task:
    # excel导出定时任务cron表达式，每5分钟执行一次（兜底策略）
    excel-export-cron: "0 0/5 * * * ?"
    # IP城市查询配置（使用 @ConditionalOnProperty 根据此配置自动选择服务实现）
    ip-city:
      # 高德API配置（生产环境建议在 application-secret.yaml 中配置密钥）
      amap:
        key: ${AMAP_API_KEY:dummy_key}  # 请在生产环境使用真实的API密钥
        url: https://restapi.amap.com/v3/ip
      # GeoLite2配置
      geolite2:
        db-path: "classpath:geoip/GeoLite2-City.mmdb"
        account-id: ${GEOLITE2_ACCOUNT_ID:0}  # MaxMind Account ID
        license-key: ${GEOLITE2_LICENSE_KEY:dummy_key}  # MaxMind License Key
        url: https://geolite.info/geoip/v2.1/city
      # 缓存配置
      cache:
        caffeine-ttl-seconds: 3600  # L1 本地缓存过期时间 (默认1小时)
        caffeine-max-size: 10000    # L1 本地缓存最大条目数 (默认10000)
        redis-ttl-seconds: 86400    # L2 Redis缓存过期时间 (默认24小时)



ok:
  http:
    connect-timeout: 10s
    read-timeout: 10s
    write-timeout: 10s
    connection-pool:
      max-idle-connections: 32
      keep-alive-duration: 5m
    follow-ssl-redirects: true
    follow-redirects: true

# 文件上传配置
upload:
  mode: local # local, qiniu, s3
  local:
    path: E:\sunxu\http
    domain: http://localhost:8084
  qiniu:
    access-key: ${QINIU_ACCESS_KEY}
    secret-key: ${QINIU_SECRET_KEY}
    bucket: ${QINIU_BUCKET}
    domain: ${QINIU_DOMAIN}
    private-bucket: true # 开启私有空间支持
  s3:
    access-key: ${AWS_ACCESS_KEY}
    secret-key: ${AWS_SECRET_KEY}
    bucket: ${AWS_BUCKET}
    region: ${AWS_REGION}
    endpoint: ${AWS_ENDPOINT} # 可选，用于MinIO等兼容服务
